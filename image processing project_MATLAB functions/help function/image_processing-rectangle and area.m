%Find the center point with our algorithms
clear;
clc;
close all;
I=imread('ImgA000005.tif');%?????
figure(1);imshow(I);%?????
I_gray=rgb2gray(I);    %?????????
level=graythresh(I_gray);   %????I_gray??????level????????????[0 1]
[height,width]=size(I_gray);   %?????????
I_bw=im2bw(I_gray,level);  %im2bw????level?????????????
figure(2);imshow(I_bw);     %?????????????

for i=1:height %%???????
for j=1:width
if I_bw(i,j)==1
I_bw(i,j)=0;
else I_bw(i,j)=1;
end
end
end
figure(3);imshow(I_bw);%?????????????????


[L,num]=bwlabel(I_bw,8);%bwlabel??????I_bw???????????????I_bw????????num????????

plot_x=zeros(1,num);%%zeros(m,n)??m×n??0???????????????
plot_y=zeros(1,num);%zeros(m,n)??m×n??0???????????????
plot_area=zeros(1,num); %zeros(m,n)??mxn??0???????????????



for k=1:num  %%num???????????
sum_x=0;    sum_y=0;    area=0; %???
for i=1:height
for j=1:width
if L(i,j)==k
sum_x=sum_x+i;  %????????????
sum_y=sum_y+j;  %????????????
area=area+1;    %????????????????
end
end
end
plot_x(k)=fix(sum_x/area);  %????????????
plot_y(k)=fix(sum_y/area);%????????????
plot_area(k)=area;


%%rec
sym max_row
sym min_row
sym max_column
sym min_column
row=mod(  find(L==k),  size(L,1)         );
%max row
max_row(k)=max(  mod(  find(L==k),  size(L,1)         )     );
if max_row(k)==size(L,1)-1;
max_row(k)=max_row(k)+1;
end
%max_row;
%min row
min_row(k)=min(       mod(  find(L==k),size(L,1))       )
if min_row(k)==0
min_row(k)=1;
end
%max column
max_column(k)= max( ceil( find(L==k)/size(L,1)     )              )
%min column
min_column(k)= min( ceil( find(L==k)/size(L,1)    ) )
end



figure(4);imshow(I_bw);%?????????????????,???????????




for i=1:num
hold  on
plot(plot_y(i) ,plot_x(i), '*');
j=num2str(i);
text(plot_y(i),plot_x(i),j);
hold  on
plot(min_column(i),min_row(i),'o');
hold  on
plot(max_column(i),min_row(i),'o');
hold  on
plot(max_column(i),max_row(i),'o');
hold  on
plot(min_column(i),max_row(i),'o');
hold on
line([min_column(i),max_column(i)],[min_row(i),min_row(i)])
hold on
line([max_column(i),max_column(i)],[min_row(i),max_row(i)])
hold on
line([max_column(i),min_column(i)],[max_row(i),max_row(i)])
hold on
line([min_column(i),min_column(i)],[max_row(i),min_row(i)])
end



